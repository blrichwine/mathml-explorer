<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MathML Learning Workbench</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div id="app" class="app-shell">
      <header class="panel topbar" aria-label="Application Controls">
        <h1>MathML Learning Workbench</h1>
        <div class="topbar-controls" role="group" aria-label="Rendering controls">
          <label>
            MathJax Version
            <select id="mathjax-version-select" name="mathjax-version"></select>
          </label>
          <label>
            Output Mode
            <select id="mathjax-output-mode-select" name="mathjax-output-mode">
              <option value="chtml">CHTML</option>
              <option value="svg">SVG</option>
            </select>
          </label>
          <label>
            Lint Profile
            <select id="lint-profile-select" name="lint-profile-select">
              <option value="authoring-guidance">Authoring guidance</option>
              <option value="strict-core">Strict core</option>
            </select>
          </label>
          <label>
            <input id="ignore-data-mjx-toggle" type="checkbox" />
            Ignore data-mjx*
          </label>
          <label>
            Render Zoom
            <input id="render-zoom-slider" type="range" min="100" max="400" step="25" value="100" />
            <span id="render-zoom-value">100%</span>
          </label>
          <button id="share-url-button" type="button">Copy Share URL</button>
          <button id="save-json-button" type="button">Save JSON</button>
          <button id="load-json-button" type="button">Load JSON</button>
          <input id="load-json-input" type="file" accept="application/json,.json" hidden />
        </div>
      </header>
      <p id="persistence-status" class="persistence-status" aria-live="polite"></p>

      <main class="workspace" aria-label="Workspace">
        <section id="left-pane" class="panel" aria-label="Inputs">
          <details class="latex-section panel" aria-label="LaTeX Conversion">
            <summary>LaTeX to MathML</summary>
            <div class="latex-content">
              <div class="section-head">
                <h2>LaTeX to MathML</h2>
                <div class="button-row">
                  <label>
                    Target
                    <select id="latex-target-select" name="latex-target-select">
                      <option value="A">MathML A</option>
                      <option value="B">MathML B</option>
                    </select>
                  </label>
                  <button id="convert-latex-button" type="button">Convert LaTeX</button>
                </div>
              </div>

              <div class="latex-grid">
                <article class="latex-card">
                  <h3>LaTeX Setup</h3>
                  <p class="small-note">Use setup notes such as <code>packages: mhchem, physics, unicode</code> or <code>\\require{mhchem}</code>.</p>
                  <textarea id="latex-setup-input" class="latex-input" spellcheck="false" aria-label="LaTeX setup"></textarea>
                </article>
                <article class="latex-card">
                  <h3>LaTeX Input</h3>
                  <textarea id="latex-input" class="latex-input" spellcheck="false" aria-label="LaTeX expression"></textarea>
                </article>
              </div>
              <p id="latex-status" class="latex-status status-idle">LaTeX conversion idle.</p>
              <pre id="latex-last-mathml" class="latex-preview"></pre>
            </div>
          </details>

          <details class="nimas-section latex-section panel" aria-label="NIMAS Import">
            <summary>NIMAS Import</summary>
            <div class="latex-content">
              <div class="section-head">
                <h2>NIMAS Import</h2>
                <div class="button-row">
                  <button id="nimas-load-folder-button" type="button" class="secondary-button">Load Folder</button>
                  <button id="nimas-load-file-button" type="button" class="secondary-button">Load XML</button>
                  <input id="nimas-file-input" type="file" accept=".xml,application/xml,text/xml,.zip,application/zip" hidden />
                </div>
              </div>
              <p id="nimas-status" class="small-note">No NIMAS source loaded yet.</p>
              <div class="nimas-controls">
                <label>
                  MathML Instance
                  <select id="nimas-instance-select" name="nimas-instance-select"></select>
                </label>
                <label>
                  Import Target
                  <select id="nimas-target-select" name="nimas-target-select">
                    <option value="A">MathML A</option>
                    <option value="B">MathML B</option>
                  </select>
                </label>
                <button id="nimas-import-button" type="button">Import Selected MathML</button>
              </div>
              <p id="nimas-instance-meta" class="small-note"></p>
              <img id="nimas-image-preview" class="nimas-image hidden" alt="NIMAS linked image preview" />
            </div>
          </details>

          <details class="nimas-section latex-section panel" aria-label="EPUB Import">
            <summary>EPUB Import</summary>
            <div class="latex-content">
              <div class="section-head">
                <h2>EPUB Import</h2>
                <div class="button-row">
                  <button id="epub-load-folder-button" type="button" class="secondary-button">Load Folder</button>
                  <button id="epub-load-file-button" type="button" class="secondary-button">Load File</button>
                  <input id="epub-file-input" type="file" accept=".xhtml,.html,.xml,.opf,.epub,.zip,application/xhtml+xml,text/html,application/xml,text/xml,application/epub+zip,application/zip" hidden />
                </div>
              </div>
              <p id="epub-status" class="small-note">No EPUB source loaded yet.</p>
              <div class="nimas-controls">
                <label>
                  MathML Instance
                  <select id="epub-instance-select" name="epub-instance-select"></select>
                </label>
                <label>
                  Import Target
                  <select id="epub-target-select" name="epub-target-select">
                    <option value="A">MathML A</option>
                    <option value="B">MathML B</option>
                  </select>
                </label>
                <button id="epub-import-button" type="button">Import Selected MathML</button>
              </div>
              <p id="epub-instance-meta" class="small-note"></p>
              <img id="epub-image-preview" class="nimas-image hidden" alt="EPUB linked image preview" />
            </div>
          </details>

          <div class="section-head">
            <h2>MathML Inputs</h2>
            <div class="button-row">
              <button id="format-a-button" type="button">Autoformat A</button>
              <button id="format-b-button" type="button">Autoformat B</button>
            </div>
          </div>

          <div class="editor-grid">
            <article class="editor-card" aria-labelledby="mathml-a-title">
              <div class="editor-card-head">
                <h3 id="mathml-a-title">MathML A</h3>
                <button id="expand-a-button" type="button" class="secondary-button">Expand</button>
              </div>
              <div class="inplace-editor">
                <pre id="mathml-a-highlight" class="highlight" aria-label="Syntax highlighted MathML A"></pre>
                <textarea id="mathml-a-input" class="code-input" spellcheck="false" aria-label="MathML input A"></textarea>
              </div>
              <div class="warnings-block">
                <h4>Warnings</h4>
                <ul id="mathml-a-warnings" class="warning-list"></ul>
              </div>
            </article>

            <article class="editor-card" aria-labelledby="mathml-b-title">
              <div class="editor-card-head">
                <h3 id="mathml-b-title">MathML B</h3>
                <button id="expand-b-button" type="button" class="secondary-button">Expand</button>
              </div>
              <div class="inplace-editor">
                <pre id="mathml-b-highlight" class="highlight" aria-label="Syntax highlighted MathML B"></pre>
                <textarea id="mathml-b-input" class="code-input" spellcheck="false" aria-label="MathML input B"></textarea>
              </div>
              <div class="warnings-block">
                <h4>Warnings</h4>
                <ul id="mathml-b-warnings" class="warning-list"></ul>
              </div>
            </article>
          </div>

          <section id="help-pane" class="panel embedded-help" aria-live="polite" aria-label="Context Help">
            <h2>Context Help</h2>
            <p id="context-summary" class="context-summary">Move the cursor in MathML A or B to show tag guidance.</p>
            <p id="context-entity-summary" class="small-note">Entity: cursor is not inside an entity reference.</p>
            <div class="help-grid">
              <section>
                <h3>Valid Child Tags</h3>
                <ul id="context-children-list" class="help-list"></ul>
              </section>
              <section>
                <h3>Valid Attributes</h3>
                <ul id="context-attributes-list" class="help-list"></ul>
              </section>
            </div>

            <section class="intent-assistant" aria-label="Intent Assistant">
              <h3>Intent Assistant</h3>
              <p id="intent-assistant-target" class="small-note">Select a tag in MathML A or B to target intent insertion.</p>
              <div class="intent-assistant-controls">
                <label>
                  Template
                  <select id="intent-assistant-preset" name="intent-assistant-preset">
                    <option value="">Select template...</option>
                    <optgroup label="Common Templates">
                      <option value="grouped-expression">Grouped expression</option>
                      <option value="function($f, $x)">Function</option>
                      <option value="fraction($num, $den)">Fraction</option>
                      <option value="power($base, $exp)">Power</option>
                      <option value="subscript($base, $sub)">Subscript</option>
                      <option value="limit($base, $under, $over)">Limit</option>
                      <option value="operator">Operator</option>
                    </optgroup>
                    <optgroup label="Core Properties: Fixity">
                      <option value="f:function($x,$y)">function</option>
                      <option value="f:prefix($x,$y)">prefix</option>
                      <option value="f:postfix($x)">postfix</option>
                      <option value="f:infix($x,$y)">infix</option>
                      <option value="f:silent($x,$y)">silent</option>
                    </optgroup>
                    <optgroup label="Core Properties: Inference">
                      <option value=":literal">literal</option>
                      <option value=":common">common</option>
                      <option value=":legacy">legacy</option>
                    </optgroup>
                    <optgroup label="Core Properties: Table">
                      <option value=":array">array</option>
                      <option value=":array:by-column">array + by-column</option>
                      <option value=":matrix">matrix</option>
                      <option value=":piecewise">piecewise</option>
                      <option value=":system-of-equations">system-of-equations</option>
                      <option value=":lines">lines</option>
                      <option value=":continued-row">continued-row</option>
                      <option value=":by-row">by-row</option>
                      <option value=":by-column">by-column</option>
                      <option value=":equation-label">equation-label</option>
                      <option value=":no-equation-label">no-equation-label</option>
                    </optgroup>
                    <optgroup label="Core Properties: Math Category">
                      <option value=":number-set">number-set</option>
                      <option value=":largeop">largeop</option>
                      <option value="sum:largeop($from,$to,$arg)">largeop (sum template)</option>
                    </optgroup>
                    <optgroup label="Core Properties: Units/Time/Number/Geometry">
                      <option value=":unit">unit</option>
                      <option value=":currency">currency</option>
                      <option value=":date">date</option>
                      <option value=":time">time</option>
                      <option value=":roman-numeral">roman-numeral</option>
                      <option value=":shape">shape</option>
                    </optgroup>
                    <optgroup label="Core Properties: Chemistry">
                      <option value=":chemical-element">chemical-element</option>
                      <option value=":chemical-formula">chemical-formula</option>
                      <option value=":chemical-equation">chemical-equation</option>
                    </optgroup>
                    <optgroup label="Core Properties: Pause/Argname">
                      <option value=":pause-short">pause-short</option>
                      <option value=":pause-medium">pause-medium</option>
                      <option value=":pause-long">pause-long</option>
                      <option value=":pause-xlong">pause-xlong</option>
                      <option value=":use-argname">use-argname</option>
                    </optgroup>
                  </select>
                </label>
                <label>
                  Intent Value
                  <input id="intent-assistant-input" type="text" spellcheck="false" placeholder="e.g., function($f, $x)" />
                </label>
                <button id="intent-assistant-apply" type="button">Apply to Current Tag</button>
              </div>
              <p class="small-note">Core property reference: <a href="https://w3c.github.io/mathml-docs/intent-core-properties/" target="_blank" rel="noreferrer noopener">W3C Intent Core Properties</a></p>
              <p id="intent-assistant-status" class="small-note status-idle">Ready to apply intent.</p>
            </section>

            <section class="analysis-section" aria-label="Lint and Intent Analysis">
              <h3>Lint Findings</h3>
              <div class="analysis-grid">
                <article class="analysis-card">
                  <h4>Expression A</h4>
                  <ul id="lint-findings-a" class="analysis-list"></ul>
                </article>
                <article class="analysis-card">
                  <h4>Expression B</h4>
                  <ul id="lint-findings-b" class="analysis-list"></ul>
                </article>
              </div>

              <h3>Intent Suggestions</h3>
              <div class="analysis-grid">
                <article class="analysis-card">
                  <h4>Expression A</h4>
                  <ul id="intent-suggestions-a" class="analysis-list"></ul>
                </article>
                <article class="analysis-card">
                  <h4>Expression B</h4>
                  <ul id="intent-suggestions-b" class="analysis-list"></ul>
                </article>
              </div>
            </section>
          </section>
        </section>

        <section id="right-pane" class="panel" aria-label="Outputs">
          <div class="section-head">
            <h2>Outputs</h2>
            <p id="mathjax-load-status" class="mathjax-status status-idle">MathJax: idle</p>
          </div>
          <div class="split-output">
            <article class="output-card">
              <h3>Native Render A</h3>
              <div id="native-render-a" class="output-box" aria-label="Native Render A"></div>
            </article>
            <article class="output-card">
              <h3>Native Render B</h3>
              <div id="native-render-b" class="output-box" aria-label="Native Render B"></div>
            </article>
            <article class="output-card">
              <h3>MathJax Render A</h3>
              <div id="mathjax-render-a" class="output-box" aria-label="MathJax Render A"></div>
            </article>
            <article class="output-card">
              <h3>MathJax Render B</h3>
              <div id="mathjax-render-b" class="output-box" aria-label="MathJax Render B"></div>
            </article>
          </div>
        </section>

        <section id="accessibility-pane" class="panel" aria-label="Accessibility and Diff">
          <section class="a11y-section" aria-label="Accessibility Outputs">
            <div class="section-head">
              <h3>Accessibility Outputs (A/B)</h3>
            </div>
            <p id="mathcat-engine-status" class="engine-status status-idle">MathCAT: idle</p>
            <p id="sre-engine-status" class="engine-status status-idle">SRE: idle</p>

            <div class="a11y-grid">
              <article class="a11y-card">
                <h4>MathCAT ClearSpeak</h4>
                <p id="output-status-mathcatClearspeak" class="channel-status status-idle"></p>
                <div class="a11y-columns">
                  <div><h5>A</h5><pre id="output-mathcatClearspeak-a" class="output-text"></pre></div>
                  <div><h5>B</h5><pre id="output-mathcatClearspeak-b" class="output-text"></pre></div>
                </div>
              </article>

              <article class="a11y-card">
                <h4>MathCAT SimpleSpeak</h4>
                <p id="output-status-mathcatSimplespeak" class="channel-status status-idle"></p>
                <div class="a11y-columns">
                  <div><h5>A</h5><pre id="output-mathcatSimplespeak-a" class="output-text"></pre></div>
                  <div><h5>B</h5><pre id="output-mathcatSimplespeak-b" class="output-text"></pre></div>
                </div>
              </article>

              <article class="a11y-card">
                <h4>MathCAT Braille</h4>
                <p id="output-status-mathcatBraille" class="channel-status status-idle"></p>
                <div class="a11y-columns">
                  <div><h5>A</h5><pre id="output-mathcatBraille-a" class="output-text"></pre></div>
                  <div><h5>B</h5><pre id="output-mathcatBraille-b" class="output-text"></pre></div>
                </div>
              </article>

              <article class="a11y-card">
                <h4>SRE ClearSpeak</h4>
                <p id="output-status-sreClearspeak" class="channel-status status-idle"></p>
                <div class="a11y-columns">
                  <div><h5>A</h5><pre id="output-sreClearspeak-a" class="output-text"></pre></div>
                  <div><h5>B</h5><pre id="output-sreClearspeak-b" class="output-text"></pre></div>
                </div>
              </article>

              <article class="a11y-card">
                <h4>SRE MathSpeak</h4>
                <p id="output-status-sreMathspeak" class="channel-status status-idle"></p>
                <div class="a11y-columns">
                  <div><h5>A</h5><pre id="output-sreMathspeak-a" class="output-text"></pre></div>
                  <div><h5>B</h5><pre id="output-sreMathspeak-b" class="output-text"></pre></div>
                </div>
              </article>
            </div>
          </section>

          <section class="diff-section" aria-label="A/B Output Diff">
            <div class="section-head">
              <h3>A/B Output Diff (Same Channel)</h3>
              <div class="diff-controls">
                <label>
                  Channel
                  <select id="diff-channel-select" name="diff-channel-select"></select>
                </label>
                <label>
                  View
                  <select id="diff-view-select" name="diff-view-select">
                    <option value="unified">Unified</option>
                    <option value="side-by-side">Side by side</option>
                  </select>
                </label>
              </div>
            </div>
            <p id="diff-summary" class="diff-summary"></p>
            <pre id="diff-unified" class="diff-pane"></pre>
            <div id="diff-side-by-side" class="diff-side hidden">
              <article class="diff-card">
                <h4>A</h4>
                <pre id="diff-side-a" class="diff-pane"></pre>
              </article>
              <article class="diff-card">
                <h4>B</h4>
                <pre id="diff-side-b" class="diff-pane"></pre>
              </article>
            </div>
          </section>
        </section>
      </main>

      <aside id="status-pane" class="panel" aria-label="Status">
        <details>
          <summary>Status</summary>
          <pre id="status-json" class="status-json" aria-live="polite"></pre>
        </details>
      </aside>
    </div>

    <div id="editor-modal-backdrop" class="modal-backdrop hidden" aria-hidden="true">
      <section class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="editor-modal-title">
        <div class="modal-head">
          <h2 id="editor-modal-title">Edit MathML</h2>
          <div class="button-row">
            <button id="editor-modal-format" type="button" class="secondary-button">Autoformat</button>
            <button id="editor-modal-close" type="button">Close</button>
          </div>
        </div>
        <div class="modal-inplace-editor">
          <pre id="editor-modal-highlight" class="highlight modal-highlight" aria-label="Syntax highlighted modal MathML editor"></pre>
          <textarea id="editor-modal-input" class="modal-input" spellcheck="false" aria-label="Large MathML editor"></textarea>
        </div>
      </section>
    </div>

    <div id="nimas-image-modal-backdrop" class="modal-backdrop hidden" aria-hidden="true">
      <section class="modal-panel nimas-image-modal-panel" role="dialog" aria-modal="true" aria-labelledby="nimas-image-modal-title">
        <div class="modal-head">
          <h2 id="nimas-image-modal-title">NIMAS Linked Image</h2>
          <div class="button-row">
            <label>
              Zoom
              <input id="nimas-image-zoom-range" type="range" min="100" max="400" step="25" value="100" />
            </label>
            <span id="nimas-image-zoom-value" class="small-note">100%</span>
            <button id="nimas-image-modal-close" type="button">Close</button>
          </div>
        </div>
        <div class="nimas-image-modal-body">
          <img id="nimas-image-modal-view" class="nimas-image-modal-view" alt="NIMAS image full size preview" />
        </div>
      </section>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
